<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>食物繊維計算ツール</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 20px auto;
    padding: 10px;
  }
  .food-entry {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    position: relative;
    align-items: center;
  }
  input[type="text"],
  input[type="number"] {
    padding: 8px;
    font-size: 1rem;
  }
  input[type="text"] {
    flex: 2;
  }
  input[type="number"] {
    flex: 1;
  }
  button {
    padding: 6px 10px;
    font-size: 1rem;
    cursor: pointer;
  }
  #addFoodBtn {
    margin-bottom: 20px;
  }
  .result {
    margin-top: 20px;
    padding: 12px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    white-space: pre-line;
  }
  .autocomplete-items {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-top: none;
    max-height: 200px;
    overflow-y: auto;
    z-index: 9999;
    background: white;
    width: 100%;
    box-sizing: border-box;
  }
  .autocomplete-items div {
    padding: 8px;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .autocomplete-items div:hover,
  .autocomplete-active {
    background-color: #e9e9e9;
  }
  .fiber-info {
    font-size: 0.85rem;
    color: #333;
    margin-left: 6px;
    white-space: nowrap;
  }
  .delete-btn {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
  }

  /* レスポンシブ対応 */
  @media (max-width: 600px) {
    body {
      padding: 10px;
      font-size: 16px;
    }
    .food-entry {
      flex-direction: column;
      align-items: stretch;
    }
    input[type="text"],
    input[type="number"],
    button {
      width: 100%;
      font-size: 18px;
    }
    button {
      margin-top: 6px;
    }
    .autocomplete-items {
      max-height: 150px;
    }
  }
</style>
</head>
<body>
<h1>食物繊維計算ツール</h1>

<p id="note">
  ※ 摂取量は「グラム (g)」で入力してください。<br />
  ※ 食材・料理ごとの食物繊維量は「100gあたりの食物繊維量 (g)」を基に計算しています。
</p>

<div id="foodList"></div>

<button id="addFoodBtn">食材・料理を追加する</button>
<button id="calcBtn">合計食物繊維量を計算する</button>

<div class="result" id="result">ここに結果が表示されます</div>
<div id="dailyGoal" style="margin-top:10px; font-weight:bold;"></div>

<script>
  const foodData = [
    { name: "アスパラガス", fiber: 2.1 },
    { name: "インゲン豆", fiber: 6.5 },
    { name: "オクラ", fiber: 3.2 },
    { name: "かぼちゃ", fiber: 2.0 },
    { name: "きゅうり", fiber: 0.5 },
    { name: "キャベツ", fiber: 2.5 },
    { name: "ごぼう", fiber: 5.7 },
    { name: "さつまいも", fiber: 3.0 },
    { name: "しそ", fiber: 6.7 },
    { name: "しいたけ", fiber: 2.5 },
    { name: "しめじ", fiber: 2.5 },
    { name: "セロリ", fiber: 1.6 },
    { name: "たまねぎ", fiber: 1.7 },
    { name: "なす", fiber: 2.5 },
    { name: "にんじん", fiber: 2.8 },
    { name: "にんにく", fiber: 2.1 },
    { name: "ねぎ", fiber: 2.5 },
    { name: "白菜", fiber: 1.6 },
    { name: "ほうれん草", fiber: 2.2 },
    { name: "まいたけ", fiber: 2.7 },
    { name: "みかん", fiber: 1.9 },
    { name: "もやし", fiber: 1.3 },
    { name: "やまいも", fiber: 1.9 },
    { name: "れんこん", fiber: 4.0 },
    { name: "わかめ", fiber: 6.0 },

    { name: "いちご", fiber: 2.0 },
    { name: "うめ", fiber: 1.5 },
    { name: "キウイフルーツ", fiber: 3.0 },
    { name: "グレープフルーツ", fiber: 1.4 },
    { name: "すいか", fiber: 0.2 },
    { name: "バナナ", fiber: 2.6 },
    { name: "ブルーベリー", fiber: 2.4 },
    { name: "りんご", fiber: 1.9 },
    { name: "ぶどう", fiber: 0.9 },

    { name: "あずき", fiber: 7.3 },
    { name: "えんどう豆", fiber: 7.0 },
    { name: "大豆", fiber: 15.7 },
    { name: "くるみ", fiber: 6.7 },
    { name: "ごま", fiber: 11.8 },
    { name: "さやえんどう", fiber: 6.0 },
    { name: "ピーナッツ", fiber: 8.5 },
    { name: "アーモンド", fiber: 12.5 },

    { name: "アジ", fiber: 0.0 },
    { name: "イワシ", fiber: 0.0 },
    { name: "ウナギ", fiber: 0.0 },
    { name: "エビ", fiber: 0.0 },
    { name: "カツオ", fiber: 0.0 },
    { name: "サケ", fiber: 0.0 },
    { name: "サバ", fiber: 0.0 },
    { name: "タコ", fiber: 0.0 },
    { name: "タイ", fiber: 0.0 },
    { name: "マグロ", fiber: 0.0 },
    { name: "イカ", fiber: 0.0 },
    { name: "ホタテ", fiber: 0.0 },

    { name: "鶏肉（むね）", fiber: 0.0 },
    { name: "鶏肉（もも）", fiber: 0.0 },
    { name: "豚肉", fiber: 0.0 },
    { name: "牛肉", fiber: 0.0 },

    { name: "チーズ", fiber: 0.0 },
    { name: "ヨーグルト", fiber: 0.0 },
    { name: "牛乳", fiber: 0.0 },
    { name: "バター", fiber: 0.0 },

    { name: "うどん", fiber: 1.0 },
    { name: "白米", fiber: 0.5 },
    { name: "玄米", fiber: 3.0 },
    { name: "そば", fiber: 3.0 },
    { name: "そうめん", fiber: 0.3 },
    { name: "食パン", fiber: 2.7 },
    { name: "ラーメン（生麺）", fiber: 1.2 },

    { name: "しょうゆ", fiber: 0.5 },
    { name: "味噌", fiber: 4.7 },
    { name: "はちみつ", fiber: 0.0 },
    { name: "マヨネーズ", fiber: 0.0 },
    { name: "ケチャップ", fiber: 0.5 },
    { name: "カレー粉", fiber: 10.9 },
    { name: "砂糖", fiber: 0.0 },
    { name: "塩", fiber: 0.0 },
    { name: "酢", fiber: 0.0 },

    { name: "おでん", fiber: 2.0 },
    { name: "おにぎり", fiber: 0.5 },
    { name: "かつおぶし", fiber: 0.0 },
    { name: "きんぴらごぼう", fiber: 5.7 },
    { name: "ざるそば", fiber: 3.0 },
    { name: "すし", fiber: 1.0 },
    { name: "たまご焼き", fiber: 0.0 },
    { name: "天ぷら", fiber: 1.0 },
    { name: "なめこ汁", fiber: 2.0 },
    { name: "握り寿司", fiber: 1.0 },
    { name: "味噌汁", fiber: 1.5 },

    { name: "あんかけ", fiber: 1.0 },
    { name: "海老チリ", fiber: 0.0 },
    { name: "かに玉", fiber: 1.0 },
    { name: "餃子", fiber: 1.2 },
    { name: "焼売", fiber: 0.8 },
    { name: "麻婆豆腐", fiber: 2.5 },
    { name: "酢豚", fiber: 2.0 },

    { name: "ビビンバ", fiber: 4.5 },
    { name: "キムチ", fiber: 1.5 },
    { name: "キムチチゲ", fiber: 3.0 },
    { name: "チヂミ", fiber: 2.5 },

    { name: "カレーライス", fiber: 3.5 },
    { name: "オムライス", fiber: 1.5 },
    { name: "ハンバーグ", fiber: 1.0 },
    { name: "スパゲッティ", fiber: 1.8 },
    { name: "ピザ", fiber: 1.0 },
  ];

  function autocomplete(input) {
    let currentFocus;

    function closeAllLists(elmnt) {
      const items = document.querySelectorAll(".autocomplete-items");
      items.forEach((item) => {
        if (elmnt != item && elmnt != input) {
          item.parentNode.removeChild(item);
        }
      });
    }

    function addActive(x) {
      if (!x) return false;
      removeActive(x);
      if (currentFocus >= x.length) currentFocus = 0;
      if (currentFocus < 0) currentFocus = x.length - 1;
      x[currentFocus].classList.add("autocomplete-active");
    }

    function removeActive(x) {
      for (let i = 0; i < x.length; i++) {
        x[i].classList.remove("autocomplete-active");
      }
    }

    function showList() {
      let val = input.value;
      closeAllLists();
      currentFocus = -1;

      const listContainer = document.createElement("DIV");
      listContainer.setAttribute("class", "autocomplete-items");
      input.parentNode.appendChild(listContainer);

      if (!val) {
        // 入力なしの場合は全候補表示
        foodData.forEach((food) => {
          const itemDiv = document.createElement("DIV");
          itemDiv.textContent = food.name;
          itemDiv.addEventListener("click", (e) => {
            e.stopPropagation();
            input.value = food.name;
            closeAllLists();
            input.dispatchEvent(new Event("input"));
          });
          listContainer.appendChild(itemDiv);
        });
        return;
      }

      let count = 0;
      for (let i = 0; i < foodData.length; i++) {
        if (foodData[i].name.toLowerCase().includes(val.toLowerCase())) {
          const itemDiv = document.createElement("DIV");
          const idx = foodData[i].name
            .toLowerCase()
            .indexOf(val.toLowerCase());
          itemDiv.innerHTML =
            foodData[i].name.substring(0, idx) +
            "<strong>" +
            foodData[i].name.substring(idx, idx + val.length) +
            "</strong>" +
            foodData[i].name.substring(idx + val.length);
          itemDiv.addEventListener("click", (e) => {
            e.stopPropagation();
            input.value = foodData[i].name;
            closeAllLists();
            input.dispatchEvent(new Event("input"));
          });
          listContainer.appendChild(itemDiv);
          count++;
        }
      }

      if (count === 0) {
        const noItem = document.createElement("DIV");
        noItem.textContent = "候補なし";
        noItem.style.color = "#888";
        noItem.style.cursor = "default";
        listContainer.appendChild(noItem);
      }
    }

    input.addEventListener("input", showList);
    input.addEventListener("focus", showList);
    input.addEventListener("mouseenter", showList);  // ← ここ追加

    input.addEventListener("keydown", function (e) {
      let x = input.parentNode.querySelector(".autocomplete-items");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode === 40) {
        currentFocus++;
        addActive(x);
      } else if (e.keyCode === 38) {
        currentFocus--;
        addActive(x);
      } else if (e.keyCode === 13) {
        e.preventDefault();
        if (currentFocus > -1) {
          if (x) x[currentFocus].click();
        }
      }
    });

    document.addEventListener("click", function (e) {
      closeAllLists(e.target);
    });
  }

  function createFoodEntry() {
    const container = document.createElement("div");
    container.classList.add("food-entry");

    const inputFood = document.createElement("input");
    inputFood.type = "text";
    inputFood.placeholder = "食材・料理名";
    container.appendChild(inputFood);

    const fiberInfo = document.createElement("span");
    fiberInfo.className = "fiber-info";
    container.appendChild(fiberInfo);

    const inputAmount = document.createElement("input");
    inputAmount.type = "number";
    inputAmount.min = "0";
    inputAmount.step = "0.1";
    inputAmount.placeholder = "g";
    container.appendChild(inputAmount);

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "削除";
    deleteBtn.className = "delete-btn";
    deleteBtn.type = "button";
    deleteBtn.addEventListener("click", () => {
      container.remove();
    });
    container.appendChild(deleteBtn);

    autocomplete(inputFood);

    inputFood.addEventListener("input", () => {
      const foodName = inputFood.value;
      const found = foodData.find((f) => f.name === foodName);
      fiberInfo.textContent = found ? `${found.fiber} g/100g` : "";
    });

    return container;
  }

  const foodList = document.getElementById("foodList");
  foodList.appendChild(createFoodEntry());

  document.getElementById("addFoodBtn").addEventListener("click", () => {
    foodList.appendChild(createFoodEntry());
  });

  document.getElementById("calcBtn").addEventListener("click", () => {
    const entries = foodList.querySelectorAll(".food-entry");
    let totalFiber = 0;
    let invalidEntries = false;

    entries.forEach((entry) => {
      const foodName = entry.querySelector('input[type="text"]').value.trim();
      const amountStr = entry.querySelector('input[type="number"]').value.trim();
      const amount = parseFloat(amountStr);

      if (!foodName || isNaN(amount) || amount <= 0) {
        return;
      }
      const food = foodData.find((f) => f.name === foodName);
      if (food) {
        totalFiber += (food.fiber * amount) / 100;
      } else {
        invalidEntries = true;
      }
    });

    const resultDiv = document.getElementById("result");
    if (invalidEntries) {
      resultDiv.textContent =
        "※ 食材名に誤りがあるものがありました。正しい名前を選択してください。\n";
    } else {
      resultDiv.textContent = "";
    }
    resultDiv.textContent += `合計食物繊維量: ${totalFiber.toFixed(2)} g`;

    const dailyGoalDiv = document.getElementById("dailyGoal");
    dailyGoalDiv.textContent =
      "【日本人の1日の食物繊維目安】成人男性：20g以上、成人女性：18g以上";
  });
</script>
</body>
</html>
