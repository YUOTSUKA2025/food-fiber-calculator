<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>食物繊維計算ツール</title>
<style>
  :root{
    --max-width:900px;
    --accent:#2b7cff;
    --danger:#e74c3c;
    --muted:#666;
  }
  body{font-family:system-ui,-apple-system,Helvetica,Arial,"Noto Sans JP",sans-serif;margin:0;background:#f4f6fb;color:#111;}
  .wrap{max-width:var(--max-width);margin:18px auto;padding:18px;background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(20,30,60,0.06);}
  h1{margin:0 0 10px 0;font-size:1.2rem;text-align:center;}
  p.note{margin:6px 0 16px 0;color:var(--muted);font-size:0.9rem;}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px;}
  .controls .col{flex:1;min-width:160px;position:relative;}
  input[type="text"], input[type="number"], select{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;font-size:1rem}
  button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
  button.secondary{background:#f0f0f0;color:#111}
  .hint{font-size:0.85rem;color:var(--muted);margin-top:8px}
  .suggestions{position:absolute;left:0;right:0;top:calc(100% + 6px);background:#fff;border:1px solid #ddd;border-radius:8px;max-height:260px;overflow:auto;z-index:9999;box-shadow:0 6px 18px rgba(20,30,60,0.06);display:none}
  .suggestions div{padding:8px 10px;cursor:pointer;white-space:nowrap}
  .suggestions div:hover,.suggestions .active{background:#f0f6ff}
  .rowlist{margin-top:16px;overflow:auto}
  table{width:100%;border-collapse:collapse;font-size:0.95rem}
  th,td{padding:8px 10px;border-bottom:1px solid #eee;text-align:left;vertical-align:middle}
  th{background:#fafafa;font-weight:700}
  td.right{text-align:right}
  .del{background:var(--danger);color:#fff;border:none;padding:6px 8px;border-radius:6px;cursor:pointer}
  .totals{margin-top:12px;padding:12px;border-radius:8px;background:#fafafa;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .goal{font-size:0.95rem;color:var(--muted)}
  .references{margin-top:30px;padding-top:20px;border-top:1px solid #ddd;color:#444;font-size:0.85rem;line-height:1.5;}
  .references h2{font-size:1.1rem;margin-bottom:8px;text-align:center;}
  .references ul{padding-left:20px;}
  @media (max-width:720px){
    .controls{flex-direction:column}
    .suggestions{max-height:180px}
    th,td{font-size:0.9rem}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>食物繊維計算ツール</h1>
    <p class="note">※ 摂取量はグラム (g) で入力してください。値は 100g あたりの食物繊維量 (g) の目安です。男性約21g・女性約18g/日 が目安。</p>

    <div class="controls">
      <div class="col">
        <label for="food">食材・料理</label>
        <input id="food" type="text" placeholder="食材名を入力（候補から選択してください）" autocomplete="off" />
        <div id="suggest" class="suggestions" role="listbox"></div>
        <div class="hint" id="fiberPer100Hint"></div>
      </div>

      <div class="col" style="max-width:180px;">
        <label for="amount">摂取量 (g)</label>
        <input id="amount" type="number" inputmode="decimal" step="any" placeholder="例: 100" />
      </div>

      <div style="display:flex;gap:8px;align-items:flex-end">
        <button id="addBtn">追加</button>
        <button id="clearBtn" class="secondary">クリア</button>
      </div>
    </div>

    <div class="rowlist">
      <table id="table">
        <thead>
          <tr>
            <th style="width:40%">食材・料理</th>
            <th style="width:18%">摂取量 (g)</th>
            <th style="width:22%">100gあたり繊維 (g)</th>
            <th style="width:10%" class="right">量 (g)</th>
            <th style="width:10%">削除</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="totals">
      <div class="goal"><strong id="total">合計食物繊維量: 0.00 g</strong></div>
      <div class="goal">目安 — 成人男性: 約 <strong>21 g</strong> / 日、成人女性: 約 <strong>18 g</strong> / 日</div>
    </div>

    <div class="references">
      <h2>参考文献・資料</h2>
      <ul>
        <li>日本食品標準成分表2020年版（八訂） - 文部科学省</li>
        <li>「食物繊維とは」 - 厚生労働省 e-ヘルスネット</li>
        <li>農林水産省「日本の食生活と栄養」報告書</li>
        <li>健康日本21（第二次） - 厚生労働省</li>
        <li>各種食品成分データベース、栄養分析文献</li>
      </ul>
    </div>
  </div>

<script>
const foodData = [
  {name:"アスパラガス",fiber:2.1},{name:"インゲン",fiber:6.5},{name:"オクラ",fiber:3.2},
  {name:"かぼちゃ",fiber:2.0},{name:"きゅうり",fiber:0.5},{name:"キャベツ",fiber:2.5},
  {name:"ごぼう",fiber:5.7},{name:"さつまいも",fiber:3.0},{name:"しそ",fiber:6.7},
  {name:"しいたけ",fiber:2.5},{name:"しめじ",fiber:2.5},{name:"セロリ",fiber:1.6},
  {name:"たまねぎ",fiber:1.7},{name:"なす",fiber:2.5},{name:"にんじん",fiber:2.8},
  {name:"にんにく",fiber:2.1},{name:"ねぎ",fiber:2.5},{name:"白菜",fiber:1.6},
  {name:"ほうれん草",fiber:2.2},{name:"まいたけ",fiber:2.7},{name:"もやし",fiber:1.3},
  {name:"山芋",fiber:1.9},{name:"れんこん",fiber:4.0},{name:"ブロッコリー",fiber:4.4},
  {name:"芽キャベツ",fiber:3.8},{name:"カリフラワー",fiber:2.0},{name:"ズッキーニ",fiber:1.1},
  {name:"パプリカ",fiber:1.5},{name:"アボカド",fiber:6.7},{name:"水菜",fiber:1.4},
  {name:"小松菜",fiber:1.9},{name:"春菊",fiber:2.2},{name:"さやえんどう",fiber:6.0},
  {name:"えだまめ",fiber:5.0},{name:"大根",fiber:1.4},{name:"葉ねぎ",fiber:1.8},
  {name:"えのきだけ",fiber:3.9},{name:"マッシュルーム",fiber:1.0},{name:"ポルチーニ",fiber:2.8},
  {name:"りんご",fiber:1.9},{name:"バナナ",fiber:2.6},{name:"みかん",fiber:1.9},
  {name:"いちご",fiber:2.0},{name:"キウイフルーツ",fiber:3.0},{name:"ブルーベリー",fiber:2.4},
  {name:"オレンジ",fiber:2.2},{name:"ぶどう",fiber:0.9},{name:"もも",fiber:1.1},
  {name:"グレープフルーツ",fiber:1.4},{name:"パイナップル",fiber:1.4},
  {name:"マンゴー",fiber:1.6},{name:"すいか",fiber:0.2},
  {name:"大豆",fiber:15.7},{name:"あずき",fiber:7.3},{name:"納豆",fiber:6.7},
  {name:"豆腐",fiber:0.4},{name:"ピーナッツ",fiber:8.5},{name:"アーモンド",fiber:12.5},
  {name:"くるみ",fiber:6.7},{name:"ごま",fiber:11.8},{name:"黒豆",fiber:16.0},
  {name:"えんどう豆",fiber:7.0},{name:"レンズ豆",fiber:8.0},
  {name:"白米",fiber:0.5},{name:"玄米",fiber:3.0},{name:"もち",fiber:0.6},
  {name:"食パン",fiber:2.7},{name:"全粒粉パン",fiber:6.0},{name:"そば",fiber:3.0},
  {name:"うどん",fiber:1.0},{name:"ラーメン（生）",fiber:1.2},{name:"そうめん",fiber:0.3},
  {name:"オートミール",fiber:9.4},{name:"シリアル（全粒）",fiber:7.0},
  {name:"アジ",fiber:0},{name:"イワシ",fiber:0},{name:"ウナギ",fiber:0},{name:"エビ",fiber:0},
  {name:"カツオ",fiber:0},{name:"サケ",fiber:0},{name:"サバ",fiber:0},{name:"タコ",fiber:0},
  {name:"タイ",fiber:0},{name:"マグロ",fiber:0},{name:"イカ",fiber:0},{name:"ホタテ",fiber:0},
  {name:"ヒラメ",fiber:0},{name:"ブリ",fiber:0},{name:"サンマ",fiber:0},
  {name:"鶏肉（胸）",fiber:0},{name:"鶏肉（もも）",fiber:0},{name:"豚肉",fiber:0},{name:"牛肉",fiber:0},
  {name:"ハム",fiber:0},{name:"ベーコン",fiber:0},{name:"チーズ",fiber:0},{name:"ヨーグルト",fiber:0},
  {name:"牛乳",fiber:0},{name:"バター",fiber:0},
  {name:"しょうゆ",fiber:0.5},{name:"味噌",fiber:4.7},{name:"みりん",fiber:0},{name:"酢",fiber:0},
  {name:"砂糖",fiber:0},{name:"塩",fiber:0},{name:"マヨネーズ",fiber:0},{name:"ケチャップ",fiber:0.5},
  {name:"カレー粉",fiber:10.9},{name:"ごま油",fiber:0},{name:"オリーブオイル",fiber:0},
  {name:"天ぷら",fiber:1.0},{name:"コロッケ",fiber:1.2},{name:"カレーライス",fiber:3.5},
  {name:"ハンバーグ",fiber:1.0},{name:"ピザ",fiber:1.0},{name:"スパゲッティ",fiber:1.8},
  {name:"オムライス",fiber:1.5},{name:"おにぎり",fiber:0.5},{name:"寿司（握り）",fiber:1.0},
  {name:"うな重",fiber:0},{name:"ラーメン（丼）",fiber:1.5},{name:"ビビンバ",fiber:4.5},
  {name:"餃子",fiber:1.2},{name:"焼売",fiber:0.8},{name:"麻婆豆腐",fiber:2.5},{name:"酢豚",fiber:2.0},
  {name:"海老チリ",fiber:0},{name:"チヂミ",fiber:2.5},{name:"キムチ",fiber:1.5},{name:"キムチチゲ",fiber:3.0},
  {name:"わかめ（乾）",fiber:35.0},{name:"ひじき（乾）",fiber:43.3},{name:"昆布（乾）",fiber:27.1},
  {name:"干し椎茸",fiber:14.8},
  {name:"黒酢",fiber:0},{name:"豆乳",fiber:0.3},
  {name:"きんぴらごぼう",fiber:5.7},{name:"味噌汁（具あり）",fiber:1.5},{name:"なめこ汁",fiber:2.0},
  {name:"かつおぶし",fiber:0},{name:"梅干し",fiber:1.5},{name:"たまご焼き",fiber:0},
  {name:"カボチャの煮物",fiber:2.8},{name:"イモのサラダ",fiber:1.3},{name:"ポテトサラダ",fiber:1.0},
  {name:"ドライフルーツ（プルーン）",fiber:7.1},{name:"レーズン",fiber:3.7},
  {name:"コーン",fiber:2.0},{name:"枝豆（冷凍）",fiber:4.3},{name:"グラノーラ",fiber:6.5},
  {name:"プロセスチーズ",fiber:0},{name:"生クリーム",fiber:0}
];

const foodInput = document.getElementById('food');
const amountInput = document.getElementById('amount');
const suggestBox = document.getElementById('suggest');
const fiberPer100Hint = document.getElementById('fiberPer100Hint');
const addBtn = document.getElementById('addBtn');
const clearBtn = document.getElementById('clearBtn');
const tbody = document.getElementById('tbody');
const totalEl = document.getElementById('total');

let currentFocus = -1;

function findFoodByName(name) {
  return foodData.find(f => f.name === name);
}

function showSuggestions() {
  const val = foodInput.value.trim();
  suggestBox.innerHTML = '';
  currentFocus = -1;
  let matches;
  if (val === '') {
    matches = foodData.slice();
  } else {
    matches = foodData.filter(f => f.name.indexOf(val) !== -1);
  }
  if (matches.length === 0) {
    const no = document.createElement('div');
    no.textContent = '候補なし';
    no.style.color = '#888';
    suggestBox.appendChild(no);
    suggestBox.style.display = 'block';
    updateFiberHint(null);
    return;
  }
  matches.forEach((m, idx) => {
    const d = document.createElement('div');
    d.textContent = m.name + `（100gあたり ${m.fiber} g）`;
    d.setAttribute('data-index', idx);
    d.addEventListener('click', e => {
      foodInput.value = m.name;
      updateFiberHint(m);
      suggestBox.style.display = 'none';
      amountInput.focus();
    });
    suggestBox.appendChild(d);
  });
  suggestBox.style.display = 'block';
}

function updateFiberHint(food) {
  if (!food) {
    fiberPer100Hint.textContent = '';
  } else {
    fiberPer100Hint.textContent = `100gあたりの食物繊維: ${food.fiber} g`;
  }
}

foodInput.addEventListener('keydown', function(e){
  const items = suggestBox.querySelectorAll('div');
  if (!items.length) return;
  if (e.key === 'ArrowDown') {
    currentFocus++;
    if (currentFocus >= items.length) currentFocus = 0;
    setActive(items);
    e.preventDefault();
  } else if (e.key === 'ArrowUp') {
    currentFocus--;
    if (currentFocus < 0) currentFocus = items.length -1;
    setActive(items);
    e.preventDefault();
  } else if (e.key === 'Enter') {
    e.preventDefault();
    if (currentFocus > -1) {
      items[currentFocus].click();
    }
  }
});

function setActive(items) {
  items.forEach(i => i.classList.remove('active'));
  if (currentFocus > -1) {
    items[currentFocus].classList.add('active');
  }
}

foodInput.addEventListener('input', showSuggestions);
foodInput.addEventListener('focus', showSuggestions);
foodInput.addEventListener('blur', function(){
  setTimeout(() => { suggestBox.style.display = 'none'; }, 200);
});

function addRow() {
  const foodName = foodInput.value.trim();
  if (!foodName) {
    alert('食材・料理名を入力してください');
    return;
  }
  const food = findFoodByName(foodName);
  if (!food) {
    alert('食材・料理名が候補にありません。リストから選択してください。');
    return;
  }
  let amount = parseFloat(amountInput.value);
  if (isNaN(amount) || amount <= 0) {
    alert('摂取量を正しく入力してください（0より大きい数値）');
    return;
  }
  // 作成行
  const tr = document.createElement('tr');
  // 食材名
  const tdName = document.createElement('td');
  tdName.textContent = foodName;
  tr.appendChild(tdName);
  // 摂取量
  const tdAmount = document.createElement('td');
  tdAmount.textContent = amount.toFixed(2);
  tr.appendChild(tdAmount);
  // 100gあたり食物繊維量
  const tdFiber100 = document.createElement('td');
  tdFiber100.textContent = food.fiber.toFixed(2);
  tr.appendChild(tdFiber100);
  // 食物繊維量（計算）
  const fiberAmount = amount * food.fiber / 100;
  const tdFiber = document.createElement('td');
  tdFiber.textContent = fiberAmount.toFixed(2);
  tdFiber.classList.add('right');
  tr.appendChild(tdFiber);
  // 削除ボタン
  const tdDel = document.createElement('td');
  const delBtn = document.createElement('button');
  delBtn.textContent = '削除';
  delBtn.classList.add('del');
  delBtn.addEventListener('click', () => {
    tr.remove();
    updateTotal();
  });
  tdDel.appendChild(delBtn);
  tr.appendChild(tdDel);
  tbody.appendChild(tr);

  updateTotal();

  foodInput.value = '';
  amountInput.value = '';
  fiberPer100Hint.textContent = '';
  foodInput.focus();
}

function updateTotal() {
  let sum = 0;
  [...tbody.children].forEach(tr => {
    const fiberVal = parseFloat(tr.children[3].textContent);
    if (!isNaN(fiberVal)) sum += fiberVal;
  });
  totalEl.textContent = `合計食物繊維量: ${sum.toFixed(2)} g`;
}

addBtn.addEventListener('click', addRow);
clearBtn.addEventListener('click', () => {
  tbody.innerHTML = '';
  updateTotal();
});

</script>
</body>
</html>
