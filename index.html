<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>食物繊維計算ツール</title>
<style>
  :root {
    --primary: #1e88e5;
    --primary-light: #6ab7ff;
    --primary-dark: #005cb2;
    --bg: #f9fbfd;
    --text: #222;
    --muted: #666;
    --border: #ddd;
    --danger: #e53935;
    --radius: 12px;
    --shadow: rgba(0,0,0,0.08);
    --font-family: "Noto Sans JP", "Helvetica Neue", Helvetica, Arial, sans-serif;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: var(--font-family);
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .container {
    max-width: 960px;
    margin: 24px auto;
    background: #fff;
    padding: 24px 30px 40px;
    border-radius: var(--radius);
    box-shadow: 0 8px 20px var(--shadow);
  }
  h1 {
    margin: 0 0 16px 0;
    font-weight: 700;
    font-size: 1.8rem;
    color: var(--primary-dark);
    text-align: center;
  }
  p.note {
    font-size: 0.95rem;
    color: var(--muted);
    margin-top: 0; margin-bottom: 28px;
    line-height: 1.5;
    text-align: center;
  }
  .form-row {
    display: flex;
    gap: 2px;
    flex-wrap: wrap;
    margin-bottom: 28px;
    justify-content: center;
  }
  .form-group {
    position: relative;
  }
  .form-group.food {
    flex: 1 1 320px;
    min-width: 280px;
  }
  .form-group.amount {
    flex: 0 0 110px;
    min-width: 100px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--primary-dark);
  }
  input[type="text"],
  input[type="number"] {
    width: 100%;
    padding: 10px 12px;
    font-size: 1.1rem;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus,
  input[type="number"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary-light);
  }
  .suggestions {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    background: #fff;
    border: 1.8px solid var(--primary-light);
    border-radius: var(--radius);
    max-height: 280px;
    overflow-y: auto;
    box-shadow: 0 6px 14px var(--shadow);
    z-index: 10000;
    display: none;
  }
  .suggestions div {
    padding: 8px 12px;
    cursor: pointer;
    font-size: 1rem;
    white-space: nowrap;
    user-select: none;
    color: var(--text);
  }
  .suggestions div:hover,
  .suggestions .active {
    background-color: var(--primary-light);
    color: #fff;
  }
  .hint {
    margin-top: 4px;
    font-size: 0.9rem;
    color: var(--muted);
    user-select: none;
  }
  .btn-group {
    display: flex;
    align-items: flex-end;
    gap: 14px;
  }
  button {
    padding: 14px 24px;
    font-size: 1.1rem;
    font-weight: 700;
    border-radius: var(--radius);
    border: none;
    cursor: pointer;
    background-color: var(--primary);
    color: #fff;
    box-shadow: 0 3px 8px var(--primary-light);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover,
  button:focus {
    background-color: var(--primary-dark);
    box-shadow: 0 4px 12px var(--primary-dark);
    outline: none;
  }
  button.secondary {
    background-color: #eee;
    color: var(--text);
    box-shadow: none;
  }
  button.secondary:hover,
  button.secondary:focus {
    background-color: #ddd;
  }
  .table-wrapper {
    max-height: 420px;
    overflow-y: auto;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    box-shadow: inset 0 2px 8px var(--shadow);
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1rem;
    min-width: 600px;
  }
  thead {
    background: var(--primary);
    color: #fff;
    position: sticky;
    top: 0;
    z-index: 5;
  }
  th, td {
    padding: 10px 12px;
    border-bottom: 1px solid #ddd;
    text-align: left;
    vertical-align: middle;
  }
  th.right,
  td.right {
    text-align: right;
  }
  tbody tr:hover {
    background-color: #f0f8ff;
  }
  button.del {
    background-color: var(--danger);
    padding: 6px 12px;
    font-weight: 700;
    border-radius: var(--radius);
    font-size: 0.95rem;
    box-shadow: none;
  }
  button.del:hover,
  button.del:focus {
    background-color: #b71c1c;
    outline: none;
  }
  .totals {
    margin-top: 24px;
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary-dark);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
  }
  .totals .goal {
    font-size: 1rem;
    font-weight: 500;
    color: var(--muted);
    text-align: right;
    min-width: 200px;
  }
  .references {
    margin-top: 40px;
    border-top: 1px solid var(--border);
    padding-top: 18px;
    font-size: 0.9rem;
    color: var(--muted);
  }
  .references h2 {
    text-align: center;
    margin-bottom: 14px;
    font-weight: 700;
    color: var(--primary-dark);
  }
  .references ul {
    max-width: 700px;
    margin: 0 auto;
    padding-left: 20px;
  }
  .references ul li {
    margin-bottom: 6px;
  }
  @media (max-width: 720px) {
    .container {
      padding: 18px 16px 30px;
    }
    .form-row {
      flex-direction: column;
      gap: 16px;
    }
    table {
      min-width: 100%;
      font-size: 0.9rem;
    }
    thead th {
      font-size: 0.85rem;
    }
    .totals {
      flex-direction: column;
      align-items: flex-start;
      font-size: 1.1rem;
    }
    .totals .goal {
      text-align: left;
      min-width: unset;
    }
  }
</style>
</head>
<body>
  <main class="container" role="main" aria-label="食物繊維計算ツール">
    <h1>食物繊維計算ツール</h1>
    <p class="note" role="note">※ 摂取量はグラム (g) で入力してください。値は 100g あたりの食物繊維量 (g) の目安です。成人男性 約21g、成人女性 約18g／日 が目安です。</p>

    <section class="form-row" aria-label="入力フォーム">
      <div class="form-group food">
        <label for="food">食材・料理名</label>
        <input id="food" type="text" placeholder="例: ごぼう, ラーメン, キムチ など" autocomplete="off" aria-autocomplete="list" aria-haspopup="listbox" aria-controls="suggest" aria-expanded="false" />
        <div id="suggest" class="suggestions" role="listbox" aria-label="食材候補"></div>
        <div class="hint" id="fiberPer100Hint" aria-live="polite" aria-atomic="true"></div>
      </div>
      <div class="form-group amount">
        <label for="amount">摂取量 (g)</label>
        <input id="amount" type="number" inputmode="decimal" step="any" min="0" placeholder="例: 100" aria-describedby="amountHint" />
      </div>
      <div class="btn-group" aria-label="操作ボタン">
        <button id="addBtn" type="button" aria-label="食材を追加">追加</button>
        <button id="clearBtn" type="button" class="secondary" aria-label="リストをクリア">クリア</button>
      </div>
    </section>

    <section class="table-wrapper" aria-label="食材・料理リスト">
      <table>
        <thead>
          <tr>
            <th>食材・料理</th>
            <th style="width:15%">摂取量 (g)</th>
            <th style="width:20%">100gあたり繊維 (g)</th>
            <th style="width:15%" class="right">量 (g)</th>
            <th style="width:15%">削除</th>
          </tr>
        </thead>
        <tbody id="tbody" aria-live="polite" aria-relevant="additions removals"></tbody>
      </table>
    </section>

    <section class="totals" aria-label="合計食物繊維量">
      <div id="total" role="status" aria-live="polite" aria-atomic="true">合計食物繊維量: 0.00 g</div>
      <div class="goal">目安 — 成人男性: 約 <strong>21 g</strong> / 日、成人女性: 約 <strong>18 g</strong> / 日</div>
    </section>

    <section class="references" aria-label="参考文献・資料">
      <h2>参考文献・資料</h2>
      <ul>
        <li>日本食品標準成分表2020年版（八訂） - 文部科学省</li>
        <li>「食物繊維とは」 - 厚生労働省 健康局 食生活改善課</li>
        <li>「食物繊維の健康効果」 - 日本食品科学工学会</li>
        <li>日本栄養士会「食物繊維摂取のすすめ」資料</li>
      </ul>
    </section>
  </main>

<script>
const foodData = [
  {name:"あずき",fiber:7.1},{name:"イカ",fiber:0.3},{name:"いちご",fiber:2.0},
  {name:"インゲン豆",fiber:5.7},{name:"うどん",fiber:1.0},{name:"オクラ",fiber:3.9},
  {name:"おにぎり",fiber:1.5},{name:"かぼちゃ",fiber:3.0},{name:"かまぼこ",fiber:0.4},
  {name:"カレーライス",fiber:3.0},{name:"キャベツ",fiber:2.2},{name:"きゅうり",fiber:0.9},
  {name:"牛肉",fiber:0.0},{name:"ギョウザ",fiber:1.5},{name:"黒豆",fiber:7.9},
  {name:"小松菜",fiber:3.0},{name:"サケ",fiber:0.0},{name:"サバ",fiber:0.0},
  {name:"さつまいも",fiber:3.0},{name:"ししゃも",fiber:0.0},{name:"じゃがいも",fiber:2.2},
  {name:"しょうが",fiber:2.0},{name:"シュウマイ",fiber:0.8},{name:"白ごはん",fiber:0.4},
  {name:"じゃこ",fiber:0.1},{name:"スイカ",fiber:0.2},{name:"セロリ",fiber:1.3},
  {name:"そうめん",fiber:1.2},{name:"そば",fiber:4.0},{name:"大根",fiber:1.2},
  {name:"たまご",fiber:0.0},{name:"玉ねぎ",fiber:1.7},{name:"ちくわ",fiber:0.8},
  {name:"チンゲンサイ",fiber:1.7},{name:"豆腐",fiber:1.3},{name:"とうもろこし",fiber:2.0},
  {name:"鶏肉",fiber:0.0},{name:"トマト",fiber:1.0},{name:"なす",fiber:1.5},
  {name:"納豆",fiber:6.7},{name:"にんじん",fiber:2.8},{name:"にんにく",fiber:2.1},
  {name:"にんにくやく",fiber:1.9},{name:"ねぎ",fiber:1.8},{name:"のり",fiber:30.0},
  {name:"白菜",fiber:1.8},{name:"はくとう",fiber:0.6},{name:"ハンバーグ",fiber:1.0},
  {name:"ひじき",fiber:43.6},{name:"ふぐ",fiber:0.0},{name:"ほうれんそう",fiber:3.7},
  {name:"みかん",fiber:1.2},{name:"みそ汁",fiber:0.9},{name:"麦",fiber:10.0},
  {name:"めかぶ",fiber:5.0},{name:"もやし",fiber:1.5},{name:"やきとり",fiber:0.3},
  {name:"野菜サラダ",fiber:3.0},{name:"ゆで卵",fiber:0.0},{name:"ラーメン（インスタント）",fiber:1.0},
  {name:"らっきょう",fiber:5.0},{name:"りんご",fiber:2.4},{name:"わかめ",fiber:35.0},
  {name:"お茶",fiber:0.0},{name:"チーズ",fiber:0.0},{name:"牛乳",fiber:0.0},
  {name:"ヨーグルト",fiber:0.0},{name:"ピザ",fiber:1.8},{name:"パスタ",fiber:2.5},
  {name:"チャーハン",fiber:1.3},{name:"キムチ鍋",fiber:2.3},{name:"ビビンバ",fiber:2.5},
  {name:"天ぷら",fiber:0.6},{name:"寿司",fiber:0.8},{name:"シチュー",fiber:1.1},
  {name:"カレーライス",fiber:3.0}
];

const foodInput = document.getElementById('food');
const suggestBox = document.getElementById('suggest');
const amountInput = document.getElementById('amount');
const fiberPer100Hint = document.getElementById('fiberPer100Hint');
const addBtn = document.getElementById('addBtn');
const clearBtn = document.getElementById('clearBtn');
const tbody = document.getElementById('tbody');
const totalEl = document.getElementById('total');

let currentFocus = -1;

function filterFoods(input) {
  const val = input.toLowerCase();
  return foodData.filter(food => food.name.toLowerCase().includes(val));
}

function showSuggestions() {
  const val = foodInput.value.trim();
  suggestBox.innerHTML = '';
  if (!val) {
    // もし空欄なら全候補を表示
    foodData.forEach((food, i) => {
      const div = document.createElement('div');
      div.textContent = food.name;
      div.setAttribute('role', 'option');
      div.id = `suggestion-${i}`;
      div.addEventListener('mousedown', (e) => {
        e.preventDefault();
        foodInput.value = food.name;
        fiberPer100Hint.textContent = `100gあたり食物繊維量: ${food.fiber.toFixed(2)} g`;
        suggestBox.style.display = 'none';
        foodInput.setAttribute('aria-expanded', 'false');
        amountInput.focus();
      });
      suggestBox.appendChild(div);
    });
    suggestBox.style.display = 'block';
    foodInput.setAttribute('aria-expanded', 'true');
    return;
  }
  const filtered = filterFoods(val);
  if (filtered.length === 0) {
    suggestBox.style.display = 'none';
    foodInput.setAttribute('aria-expanded', 'false');
    fiberPer100Hint.textContent = '';
    return;
  }
  filtered.forEach((food, i) => {
    const div = document.createElement('div');
    div.textContent = food.name;
    div.setAttribute('role', 'option');
    div.id = `suggestion-${i}`;
    div.addEventListener('mousedown', (e) => {
      e.preventDefault();
      foodInput.value = food.name;
      fiberPer100Hint.textContent = `100gあたり食物繊維量: ${food.fiber.toFixed(2)} g`;
      suggestBox.style.display = 'none';
      foodInput.setAttribute('aria-expanded', 'false');
      amountInput.focus();
    });
    suggestBox.appendChild(div);
  });
  suggestBox.style.display = 'block';
  foodInput.setAttribute('aria-expanded', 'true');
}

function findFoodByName(name) {
  return foodData.find(food => food.name === name);
}

foodInput.addEventListener('input', () => {
  currentFocus = -1;
  showSuggestions();
  const food = findFoodByName(foodInput.value.trim());
  if (food) {
    fiberPer100Hint.textContent = `100gあたり食物繊維量: ${food.fiber.toFixed(2)} g`;
  } else {
    fiberPer100Hint.textContent = '';
  }
});
foodInput.addEventListener('focus', () => {
  currentFocus = -1;
  showSuggestions();
});
foodInput.addEventListener('blur', () => {
  setTimeout(() => {
    suggestBox.style.display = 'none';
    foodInput.setAttribute('aria-expanded', 'false');
  }, 150);
});

foodInput.addEventListener('keydown', (e) => {
  let items = suggestBox.querySelectorAll('div');
  if (!items.length) return;
  if (e.key === 'ArrowDown') {
    currentFocus++;
    if (currentFocus >= items.length) currentFocus = 0;
    setActive(items);
    e.preventDefault();
  } else if (e.key === 'ArrowUp') {
    currentFocus--;
    if (currentFocus < 0) currentFocus = items.length - 1;
    setActive(items);
    e.preventDefault();
  } else if (e.key === 'Enter') {
    e.preventDefault();
    if (currentFocus > -1) {
      items[currentFocus].dispatchEvent(new Event('mousedown'));
      currentFocus = -1;
    }
  }
});

function setActive(items) {
  items.forEach(i => i.classList.remove('active'));
  if (currentFocus > -1) {
    items[currentFocus].classList.add('active');
  }
}

function addRow() {
  const foodName = foodInput.value.trim();
  if (!foodName) {
    alert('食材・料理名を入力してください');
    return;
  }
  const food = findFoodByName(foodName);
  if (!food) {
    alert('食材・料理名が候補にありません。リストから選択してください。');
    return;
  }
  let amount = parseFloat(amountInput.value);
  if (isNaN(amount) || amount <= 0) {
    alert('摂取量を正しく入力してください（0より大きい数値）');
    return;
  }
  const tr = document.createElement('tr');
  const tdName = document.createElement('td');
  tdName.textContent = foodName;
  tr.appendChild(tdName);
  const tdAmount = document.createElement('td');
  tdAmount.textContent = amount.toFixed(2);
  tr.appendChild(tdAmount);
  const tdFiber100 = document.createElement('td');
  tdFiber100.textContent = food.fiber.toFixed(2);
  tr.appendChild(tdFiber100);
  const fiberAmount = amount * food.fiber / 100;
  const tdFiber = document.createElement('td');
  tdFiber.textContent = fiberAmount.toFixed(2);
  tdFiber.classList.add('right');
  tr.appendChild(tdFiber);
  const tdDel = document.createElement('td');
  const delBtn = document.createElement('button');
  delBtn.textContent = '削除';
  delBtn.classList.add('del');
  delBtn.setAttribute('aria-label', `削除 ${foodName}`);
  delBtn.addEventListener('click', () => {
    tr.remove();
    updateTotal();
  });
  tdDel.appendChild(delBtn);
  tr.appendChild(tdDel);
  tbody.appendChild(tr);
  updateTotal();
  foodInput.value = '';
  amountInput.value = '';
  fiberPer100Hint.textContent = '';
  foodInput.focus();
}

function updateTotal() {
  let sum = 0;
  [...tbody.children].forEach(tr => {
    const fiberVal = parseFloat(tr.children[3].textContent);
    if (!isNaN(fiberVal)) sum += fiberVal;
  });
  totalEl.textContent = `合計食物繊維量: ${sum.toFixed(2)} g`;
}

addBtn.addEventListener('click', addRow);
clearBtn.addEventListener('click', () => {
  tbody.innerHTML = '';
  updateTotal();
});
</script>

</body>
</html>
